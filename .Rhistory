simData$fleet_control$Species <- c(1,1,2,2)
simData$fleet_control$Q_index <- c(1,NA,2,NA)
simData$fleet_control$Weight1_Numbers2 <- 1
simData$fleet_control$Weight_index <- c(1,1,2,2)
# * Index data ----
simData$index_data <- rbind(
data.frame(Fleet_name = "Survey1",
Fleet_code = 1,
Species = 1,
Year = 1:nyrs,
Month = 0,
Selectivity_block = 1,
Q_block = 1,
Observation = sim$SrvIdx[1,],
Log_sd = sigma_SrvIdx),
data.frame(Fleet_name = "Survey2",
Fleet_code = 3,
Species = 2,
Year = 1:nyrs,
Month = 0,
Selectivity_block = 1,
Q_block = 1,
Observation = sim$SrvIdx[2,],
Log_sd = sigma_SrvIdx)
)
# * Catch data ----
simData$catch_data <- rbind(
data.frame(Fleet_name = "Fishery1",
Fleet_code = 2,
Species = 1,
Year = 1:nyrs,
Month = 0,
Selectivity_block = 1,
Catch = sim$ObsCatch[1,],
Log_sd = sigma_Catch),
data.frame(Fleet_name = "Fishery2",
Fleet_code = 4,
Species = 2,
Year = 1:nyrs,
Month = 0,
Selectivity_block = 1,
Catch = sim$ObsCatch[2,],
Log_sd = sigma_Catch)
)
# * Comp data ----
# - Index
tmp <- sim$ObsSrvAges[1,,]
colnames(tmp) <- paste0("Comp_",ages)
index_comp <- cbind(data.frame(Fleet_name = "Survey1",
Fleet_code = 1,
Species = 1,
Sex = 0,
Age0_Length1 = 0,
Year = 1:nyrs,
Month = 0,
Sample_size = rowSums(tmp)),
tmp
)
tmp <- sim$ObsSrvAges[2,,]
colnames(tmp) <- paste0("Comp_",ages)
index_comp2 <- cbind(data.frame(Fleet_name = "Survey2",
Fleet_code = 3,
Species = 2,
Sex = 0,
Age0_Length1 = 0,
Year = 1:nyrs,
Month = 0,
Sample_size = rowSums(tmp)),
tmp
)
# - Fishery
tmp <- sim$ObsFishAges[1,,]
colnames(tmp) <- paste0("Comp_",1:15)
fishery_comp <- cbind(data.frame(Fleet_name = "Fishery1",
Fleet_code = 2,
Species = 1,
Sex = 0,
Age0_Length1 = 0,
Year = 1:nyrs,
Month = 0,
Sample_size = rowSums(tmp)),
tmp
)
tmp <- sim$ObsFishAges[2,,]
colnames(tmp) <- paste0("Comp_",1:15)
fishery_comp2 <- cbind(data.frame(Fleet_name = "Fishery2",
Fleet_code = 4,
Species = 2,
Sex = 0,
Age0_Length1 = 0,
Year = 1:nyrs,
Month = 0,
Sample_size = rowSums(tmp)),
tmp
)
simData$comp_data <- rbind(index_comp, index_comp2, fishery_comp, fishery_comp2)
# * Empirical selectivity ----
simData$emp_sel[] <- NA
# * Fixed numbers ----
simData$NByageFixed[] <- NA
# * Age transition matrix ----
tmp <- as.data.frame(diag(1,15))
colnames(tmp) <- paste0("Length_",1:15)
atf1 <- cbind(data.frame(Age_transition_name = "Base1",
Age_transition_index = 1,
Species = 1,
Sex = 0,
Age = 1:15),
tmp
)
tmp <- as.data.frame(diag(1,15))
colnames(tmp) <- paste0("Length_",1:15)
atf2 <- cbind(data.frame(Age_transition_name = "Base2",
Age_transition_index = 2,
Species = 2,
Sex = 0,
Age = 1:15),
tmp
)
simData$age_trans_matrix <- rbind(atf1, atf2)
# * Age error ----
tmp <- as.data.frame(diag(1,15))
colnames(tmp) <- paste0("Obs_age",1:15)
age_error <- cbind(data.frame(Species = 1,
True_age = 1:15),
tmp
)
tmp <- as.data.frame(diag(1,15))
colnames(tmp) <- paste0("Obs_age",1:15)
age_error2 <- cbind(data.frame(Species = 2,
True_age = 1:15),
tmp
)
simData$age_error <- rbind(age_error, age_error2)
# * Weight-at-age ----
WAA <- as.data.frame(matrix(WAA, ncol = 15))
colnames(WAA) <- paste0("Age",1:15)
weight1 <- cbind(data.frame(Wt_name = "Base1",
Wt_index = 1,
Species = 1,
Sex = 0,
Year = 0),
WAA
)
WAA2 <- as.data.frame(matrix(WAA2, ncol = 15))
colnames(WAA2) <- paste0("Age",1:15)
weight2 <- cbind(data.frame(Wt_name = "Base2",
Wt_index = 2,
Species = 2,
Sex = 0,
Year = 0),
WAA2
)
simData$weight <- rbind(weight1, weight2)
# * Maturity ----
MatAA <- as.data.frame(matrix(MatAA, ncol = 15))
colnames(MatAA) <- paste0("Age",1:15)
maturity1 <- cbind(data.frame(Species = 1),
MatAA
)
MatAA2 <- as.data.frame(matrix(MatAA2, ncol = 15))
colnames(MatAA2) <- paste0("Age",1:15)
maturity2 <- cbind(data.frame(Species = 2),
MatAA2
)
simData$maturity <- rbind(maturity1, maturity2)
# * Sex ratio ----
sexratio <- as.data.frame(matrix(0.5, ncol = 15))
colnames(sexratio) <- paste0("Age",1:15)
simData$sex_ratio <- cbind(data.frame(Species = 1),
sexratio
)
simData$sex_ratio <- rbind(simData$sex_ratio,
cbind(data.frame(Species = 2),
sexratio
)
)
# * Mortality ----
mort <- as.data.frame(matrix(0.2, ncol = 15))
colnames(mort) <- paste0("Age",1:15)
M1_base <- cbind(data.frame(Species = 1,
Sex = 0),
mort
)
mort <- as.data.frame(matrix(0.3, ncol = 15))
colnames(mort) <- paste0("Age",1:15)
M1_base2 <- cbind(data.frame(Species = 2,
Sex = 0),
mort
)
simData$M1_base <- rbind(M1_base, M1_base2)
# * Environmental data ----
simData$env_data <- data.frame(Year = 1:nyrs,
EnvData = 1)
# * Relative foraging rate (days) ----
WAA <- as.data.frame(matrix(WAA * 50, ncol = 15))
colnames(WAA) <- paste0("Age",1:15)
Pyrs1 <- cbind(data.frame(Species = 1,
Sex = 0,
Year = 0),
WAA
)
WAA2 <- as.data.frame(matrix(WAA2 * 50, ncol = 15))
colnames(WAA2) <- paste0("Age",1:15)
Pyrs2 <- cbind(data.frame(Species = 2,
Sex = 0,
Year = 0),
WAA2
)
simData$Pyrs <- rbind(Pyrs1, Pyrs2)
# * Bioenergetics ----
simData$Ceq <- rep(4,nspp)
simData$Cindex <- rep(simData$Cindex,nspp)
simData$Pvalue <- rep(simData$Pvalue,nspp)
simData$fday <- rep(simData$fday,nspp)
simData$CA <- rep(1,nspp)
simData$CB <- rep(0,nspp)
simData$Qc <- rep(simData$Qc,nspp)
simData$Tco <- rep(simData$Tco,nspp)
simData$Tcm <- rep(simData$Tcm,nspp)
simData$Tcl <- rep(simData$Tcl,nspp)
simData$CK1 <- rep(simData$CK1,nspp)
simData$CK4 <- rep(simData$CK4,nspp)
simData$Diet_comp_weights <- rep(1,nspp)
# Fit single-species -------------------------------------------------------------
ss_run <- Rceattle::fit_mod(data_list = simData,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = TRUE,
initMode = 2,
verbose = 1)
ss_run$quantities$ration[2,1,,]
plot(x = sim$SSB[1,], y = ss_run$quantities$ssb[1,1:nyrs]); abline(1,1)
plot(x = sim$SSB[2,], y = ss_run$quantities$ssb[2,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[1,], y = ss_run$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ss_run$quantities$biomass[2,1:nyrs]); abline(1,1)
plot(x = sim$NAA[1,1:nyrs,1], y = ss_run$quantities$R[1,1:nyrs]); abline(1,1)
plot(x = sim$NAA[2,1:nyrs,1], y = ss_run$quantities$R[2,1:nyrs]); abline(1,1)
# Fit multi-species -------------------------------------------------------------
# * Full  diet -----
ind = 1
for(i in 1:dim(sim$diet_prop)[1]){ # pred
for(j in 1:dim(sim$diet_prop)[2]){ # prey
for(k in 1:dim(sim$diet_prop)[3]){ # pred age
for(l in 1:dim(sim$diet_prop)[4]){ # prey-age
for(m in 1:dim(sim$diet_prop)[5]){ # year
simData$diet_data[ind,] <- NA
simData$diet_data$Year[ind] <- m
simData$diet_data$Pred[ind] <- i
simData$diet_data$Prey[ind] <- j
simData$diet_data$Pred_sex[ind] <- 0
simData$diet_data$Prey_sex[ind] <- 0
simData$diet_data$Pred_age[ind] <- k
simData$diet_data$Prey_age[ind] <- l
simData$diet_data$Sample_size[ind] <- 200
simData$diet_data$Stomach_proportion_by_weight[ind] <- sim$diet_prop[i,j,k,l,m]
ind = ind+1
}
}
}
}
}
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run1 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run1$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run1$quantities$biomass[2,1:nyrs]); abline(1,1)
exp(ms_run1$estimated_params$log_gam_a)
exp(ms_run1$estimated_params$log_gam_b)
ms_run1$quantities$M2_at_age[2,1,,]
ms_run1$quantities$vulnerability
ms_run1$quantities$ration
sim$vulnerability
ms_run1$quantities$jnll_comp
simData$diet_data$Sample_size <- 1000
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run1 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run1$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run1$quantities$biomass[2,1:nyrs]); abline(1,1)
exp(ms_run1$estimated_params$log_gam_a)
exp(ms_run1$estimated_params$log_gam_b)
ss_run$estimated_params$log_gam_a <- log(c(1, 0.1))
ss_run$estimated_params$log_gam_b <- log(c(0.15, 0.15))
ms_run1 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run1$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run1$quantities$biomass[2,1:nyrs]); abline(1,1)
exp(ms_run1$estimated_params$log_gam_a)
exp(ms_run1$estimated_params$log_gam_b)
ms_run1$quantities$M2_at_age[2,1,,]
ms_run1$quantities$vulnerability
ms_run1$quantities$ration
sim$vulnerability
ms_run1$quantities$vulnerability
sim$vulnerability
# * Average diet across years -----
simData$diet_data[] <- NA
ind = 1
for(i in 1:dim(sim$diet_prop)[1]){ # pred
for(j in 1:dim(sim$diet_prop)[2]){ # prey
for(k in 1:dim(sim$diet_prop)[3]){ # pred age
for(l in 1:dim(sim$diet_prop)[4]){ # prey-age
simData$diet_data[ind,] <- NA
simData$diet_data$Year[ind] <- 0 # average years
simData$diet_data$Pred[ind] <- i
simData$diet_data$Prey[ind] <- j
simData$diet_data$Pred_sex[ind] <- 0
simData$diet_data$Prey_sex[ind] <- 0
simData$diet_data$Pred_age[ind] <- k
simData$diet_data$Prey_age[ind] <- l
simData$diet_data$Sample_size[ind] <- 200
simData$diet_data$Stomach_proportion_by_weight[ind] <- mean(sim$diet_prop[i,j,k,l,])
ind = ind+1
}
}
}
}
simData$diet_data$Sample_size <- 1000
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run2 <- Rceattle::fit_mod(data_list = simData,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = TRUE,
msmMode = 1,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run2$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run2$quantities$biomass[2,1:nyrs]); abline(1,1)
# * Annual prey-spp diet -----
simData$diet_data[] <- NA
ind = 1
for(i in 1:dim(sim$diet_prop)[1]){ # pred
for(j in 1:dim(sim$diet_prop)[2]){ # prey
for(k in 1:dim(sim$diet_prop)[3]){ # pred age
for(m in 1:dim(sim$diet_prop)[5]){ # year
simData$diet_data[ind,] <- NA
simData$diet_data$Year[ind] <- m
simData$diet_data$Pred[ind] <- i
simData$diet_data$Prey[ind] <- j
simData$diet_data$Pred_sex[ind] <- 0
simData$diet_data$Prey_sex[ind] <- 0
simData$diet_data$Pred_age[ind] <- k
simData$diet_data$Prey_age[ind] <- -500  # sum of prey-ages
simData$diet_data$Sample_size[ind] <- 200
simData$diet_data$Stomach_proportion_by_weight[ind] <- sum(sim$diet_prop[i,j,k,,m])
ind = ind+1
}
}
}
}
simData$diet_data$Sample_size <- 1000
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run3 <- Rceattle::fit_mod(data_list = simData,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = TRUE,
msmMode = 1,
suitMode = 4,
initMode = 2,
verbose = 1)
# * Average diet across years -----
simData$diet_data[] <- NA
ind = 1
for(i in 1:dim(sim$diet_prop)[1]){ # pred
for(j in 1:dim(sim$diet_prop)[2]){ # prey
for(k in 1:dim(sim$diet_prop)[3]){ # pred age
for(l in 1:dim(sim$diet_prop)[4]){ # prey-age
simData$diet_data[ind,] <- NA
simData$diet_data$Year[ind] <- 0 # average years
simData$diet_data$Pred[ind] <- i
simData$diet_data$Prey[ind] <- j
simData$diet_data$Pred_sex[ind] <- 0
simData$diet_data$Prey_sex[ind] <- 0
simData$diet_data$Pred_age[ind] <- k
simData$diet_data$Prey_age[ind] <- l
simData$diet_data$Sample_size[ind] <- 200
simData$diet_data$Stomach_proportion_by_weight[ind] <- mean(sim$diet_prop[i,j,k,l,])
ind = ind+1
}
}
}
}
simData$diet_data$Sample_size <- 1000
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run2 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run2$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run2$quantities$biomass[2,1:nyrs]); abline(1,1)
# * Annual prey-spp diet -----
simData$diet_data[] <- NA
ind = 1
for(i in 1:dim(sim$diet_prop)[1]){ # pred
for(j in 1:dim(sim$diet_prop)[2]){ # prey
for(k in 1:dim(sim$diet_prop)[3]){ # pred age
for(m in 1:dim(sim$diet_prop)[5]){ # year
simData$diet_data[ind,] <- NA
simData$diet_data$Year[ind] <- m
simData$diet_data$Pred[ind] <- i
simData$diet_data$Prey[ind] <- j
simData$diet_data$Pred_sex[ind] <- 0
simData$diet_data$Prey_sex[ind] <- 0
simData$diet_data$Pred_age[ind] <- k
simData$diet_data$Prey_age[ind] <- -500  # sum of prey-ages
simData$diet_data$Sample_size[ind] <- 200
simData$diet_data$Stomach_proportion_by_weight[ind] <- sum(sim$diet_prop[i,j,k,,m])
ind = ind+1
}
}
}
}
simData$diet_data$Sample_size <- 1000
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run3 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run3$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run3$quantities$biomass[2,1:nyrs]); abline(1,1)
# * Average prey-spp diet -----
simData$diet_data[] <- NA
ind = 1
for(i in 1:dim(sim$diet_prop)[1]){ # pred
for(j in 1:dim(sim$diet_prop)[2]){ # prey
for(k in 1:dim(sim$diet_prop)[3]){ # pred age
simData$diet_data[ind,] <- NA
simData$diet_data$Year[ind] <- 0 # average of years
simData$diet_data$Pred[ind] <- i
simData$diet_data$Prey[ind] <- j
simData$diet_data$Pred_sex[ind] <- 0
simData$diet_data$Prey_sex[ind] <- 0
simData$diet_data$Pred_age[ind] <- k
simData$diet_data$Prey_age[ind] <- -500 # sum of prey-ages
simData$diet_data$Sample_size[ind] <- 200
simData$diet_data$Stomach_proportion_by_weight[ind] <- mean(rowSums(sim$diet_prop[i,j,k,,]))
ind = ind+1
}
}
}
simData$diet_data$Sample_size <- 1000
simData$diet_data <- simData$diet_data %>%
filter(!is.na(Pred))
ms_run4 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run4$quantities$biomass[1,1:nyrs]); abline(1,1)
plot(x = sim$Total_Biom[2,], y = ms_run4$quantities$biomass[2,1:nyrs]); abline(1,1)
