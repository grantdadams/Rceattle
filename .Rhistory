Ptarget = 0.4, # Target is 40% B0
Plimit = 0.1, # No fishing when SB<SB10
Pstar = 0.45,
Sigma = 0.5),
file = NULL, # Don't save
estimateMode = 0, # Estimate
niter = 3, # 3 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
ms_run3 <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run$estimated_params, # Initial parameters from single species ests
M1Fun = build_M1(M1_model = 1,
updateM1 = TRUE,
M1_use_prior = FALSE,
M2_use_prior = FALSE),
HCR = Rceattle::build_hcr(HCR = 3, # Cat 1 HCR
FsprTarget = 0.4),
file = NULL, # Don't save
estimateMode = 0, # Estimate
niter = 3, # 3 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
plot_biomass(list(ms_run, ms_run3), add_ci = TRUE, incl_proj = TRUE)
plot_depletionSSB(list(ms_run, ms_run3), add_ci = TRUE, incl_proj = TRUE)
devtools::document()
################################################
# Data
################################################
library(Rceattle)
# Example
# To run the 2017 single species assessment for the Bering Sea, a data file must first be loaded:
data("BS2017SS") # Single-species data. ?BS2017SS for more information on the data
data("BS2017MS") # Multi-species data. Note: the only difference is the residual mortality (M1_base) is lower
################################################
# Estimation
################################################
# - Single-species
BS2017SS$fleet_control$proj_F_prop <- c(rep(1,3), rep(0,4))
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1)
ss_run$quantities$SB0
ss_run$quantities$biomassSSB[,ncol(ss_run$quantities$biomassSSB)]
# - Multi-species
# For the a multispecies model we from the single species parameters.
BS2017MS$fleet_control$proj_F_prop <- c(rep(1,3), rep(0,4))
ms_run <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run$estimated_params, # Initial parameters from single species ests
M1Fun = build_M1(M1_model = 1,
updateM1 = TRUE,
M1_use_prior = FALSE,
M2_use_prior = FALSE),
file = NULL, # Don't save
estimateMode = 0, # Estimate
niter = 3, # 3 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
plot_biomass(list(ss_run, ms_run), add_ci = TRUE, incl_proj = = TRUE)
plot_biomass(list(ss_run, ms_run), add_ci = TRUE, incl_proj = TRUE)
plot_recruitment(list(ss_run, ms_run), add_ci = TRUE, incl_proj = TRUE)
plot_biomass(list(ss_run, ms_run), add_ci = TRUE, incl_proj = TRUE)
is lower
BS2017SS$projyr <- 2100
BS2017MS$projyr <- 2100
################################################
# Estimation
################################################
# - Single-species
BS2017SS$fleet_control$proj_F_prop <- c(rep(1,3), rep(0,4))
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1)
ss_run$quantities$SB0
ss_run$quantities$biomassSSB[,ncol(ss_run$quantities$biomassSSB)]
# - Multi-species
# For the a multispecies model we from the single species parameters.
BS2017MS$fleet_control$proj_F_prop <- c(rep(1,3), rep(0,4))
ms_run <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run$estimated_params, # Initial parameters from single species ests
M1Fun = build_M1(M1_model = 1,
updateM1 = TRUE,
M1_use_prior = FALSE,
M2_use_prior = FALSE),
file = NULL, # Don't save
estimateMode = 0, # Estimate
niter = 3, # 3 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
plot_biomass(list(ss_run, ms_run), add_ci = TRUE, incl_proj = TRUE)
plot_recruitment(list(ss_run, ms_run), add_ci = TRUE, incl_proj = TRUE)
yrs <- BS2017SS$styr:BS2017SS$projyr
nyrs <- length(yrs)
ss_run$quantities$NByage[1,1,,nyrs]
ms_run$quantities$NByage[1,1,,nyrs]
round(ss_run$quantities$M[1,1,,nyrs], 3) # Single species
round(ms_run$quantities$M1[1,1,,nyrs], 3) # Multi species
round(ms_run$quantities$M1[1,1,], 3) # Multi species
ss_run$quantities$SB0
ss_run$quantities$biomassSSB[,ncol(ss_run$quantities$biomassSSB)]
round(ss_run$quantities$biomassSSBByage[1,1,,nyrs]) # Single species n-at-age
dim(round(ss_run$quantities$biomassSSBByage)
)
round(ss_run$quantities$biomassSSBByage[1,,nyrs]) # Single species n-at-age
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
################################################
# Data
################################################
# Example
# To run the 2018 single species assessment for the Gulf of Alaska, a data file must first be loaded:
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
################################################
# Estimation
################################################
# - Single-species
# Then the model can be fit by setting `msmMode = 0` using the `Rceattle` function:
GOA2018SS$fleet_control$proj_F_prop <- rep(1, nrow(GOA2018SS$fleet_control))
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 2)
plot_biomass(ss_run, add_ci = TRUE)
# Single-species, but estimate M
ss_run_M <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
M1Fun = build_M1(M1_model = c(1,2,1)), # Estimate M
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1)
plot_biomass(ss_run_M, add_ci = TRUE)
# - Multi-species
# For the a multispecies model we from the single species parameters.
ms_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 0, # Estimate
M1Fun = build_M1(M1_model = c(1,2,1)),
niter = 3, # 3 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 2)
alpha = exp(c(3.143, 1.975, 1.44))
################################################
# Estimate OMs w ricker ----
################################################
# - Single-species fixed M
ss_run_ricker <- Rceattle::fit_mod(
data_list = ss_run$data_list,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
recFun = build_srr(srr_fun = 3,
proj_mean_rec = FALSE,
srr_est_mode = 1,
srr_prior_mean = alpha,
srr_prior_sd = 0.2),
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1,
initMode = 2)
plot_stock_recruit(ss_run_ricker)
# - Check Bmsy
alpha <- exp(ss_run_ricker$estimated_params$rec_pars[,2])
beta <- exp(ss_run_ricker$estimated_params$rec_pars[,3])
apply(ss_run$quantities$biomassSSB, 1, max)
1/(beta/1000000)
plot_ssb(list(ss_run_ricker, ss_run), incl_proj = TRUE)
# Estimate single-species and estimate M
ss_run_M$data_list$M1_base[4,3:23] <- 0.35
ss_run_ricker_M <- Rceattle::fit_mod(
data_list = ss_run_M$data_list,
inits = ss_run_M$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
M1Fun = build_M1(M1_model = c(1,2,0),
updateM1 = TRUE,
M1_use_prior = FALSE,
M2_use_prior = FALSE),
recFun = build_srr(srr_fun = 3,
proj_mean_rec = FALSE,
srr_est_mode = 1,
srr_prior_mean = alpha,
srr_prior_sd = 0.2),
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1,
initMode = 2)
plot_ssb(ss_run_ricker_M, incl_proj = TRUE)
plot_stock_recruit(ss_run_ricker_M)
# - Multi-species
ms_run$data_list$M1_base[1,3:23] <- 0.25
ms_run$data_list$M1_base[4,3:23] <- 0.35
alpha <- exp(ss_run_ricker_M$estimated_params$rec_pars[,2])
beta <- exp(ss_run_ricker_M$estimated_params$rec_pars[,3])
ms_run$estimated_params$rec_pars[,2] <- log(alpha)
ms_run$estimated_params$rec_pars[,3] <- log(beta)
ms_run_ricker <- Rceattle::fit_mod(
data_list = ms_run$data_list,
inits = ms_run$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
map = NULL,
M1Fun = build_M1(M1_model = c(1,2,1),
updateM1 = TRUE,
M1_use_prior = FALSE,
M2_use_prior = FALSE),
recFun = build_srr(srr_fun = 3,
proj_mean_rec = FALSE,
srr_est_mode = 1,
srr_prior_mean = alpha * 3,
Bmsy_lim = c(400000, apply(ms_run$quantities$biomassSSB, 1, max)[2:3])),
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
phase = "default",
verbose = 1,
initMode = 0)
plot_ssb(ms_run_ricker, incl_proj = TRUE)
plot_stock_recruit(ms_run_ricker)
plot_ssb(list(ss_run_ricker, ss_run_ricker_M, ms_run_ricker), model_names = c("SS: fix M", "SS: est M", "MS"), incl_proj = TRUE)
plot_stock_recruit(list(ss_run_ricker, ss_run_ricker_M, ms_run_ricker), model_names = c("SS: fix M", "SS: est M", "MS"))
library(Rceattle)
library(Rceattle)
devtools::document()
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(Rceattle)
devtools::document()
library(Rceattle)
library(Rceattle)
build_srr
library(Rceattle)
library(dplyr)
################################################
# Data
################################################
# Example
# To run the 2017 single species assessment for the Bering Sea, a data file must first be loaded:
data(BS2017SS) # ?BS2017SS for more information on the data
BS2017SS$projyr <- 2060
data("BS2017MS") # Note: the only difference is the residual mortality (M1_base) is lower
BS2017MS$projyr <- 2060
BS2017SS$fleet_control$proj_F_prop <-rep(1,7)
BS2017MS$fleet_control$proj_F_prop <- rep(1, 7)
################################################
# Estimate OMs
################################################
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1,
initMode = 2)
# -- NPFMC Tier 3
ss_run_Tier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params,
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
ss_run_dynamicTier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params, # Initial parameters from ss_run
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
DynamicHCR = TRUE, # Use dynamic reference points
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
mod_list <- list(ss_run, ss_run_Tier3, ss_run_dynamicTier3)
mod_list <- list(ss_run, ss_run_Tier3, ss_run_dynamicTier3)
plot_recruitment(mod_list, incl_proj = TRUE)
plot_ssb(mod_list, incl_proj = TRUE)
lapply(mod_list, function(x) x$quantities$R[1,])
lapply(mod_list, function(x) tail(x$quantities$R[1,]))
sapply(mod_list, function(x) tail(x$quantities$R[1,]))
sapply(mod_list, function(x) tail(x$quantities$Nbyage0[1,1,,1]))
ss_run$quantities$NByage0
sapply(mod_list, function(x) tail(x$quantities$NByage0[1,1,,1]))
sapply(mod_list, function(x) tail(x$quantities$R[1,]))
sapply(mod_list, function(x) tail(x$quantities$NByage0[1,1,,1]))
ss_run$quantities$NByage0[1,1,,]
ss_run$quantities$NByage0[1,1,1,]
sapply(mod_list, function(x) tail(x$quantities$NByage0[1,1,1,]))
sapply(mod_list, function(x) tail(x$quantities$R[1,]))
sapply(mod_list, function(x) tail(x$quantities$DynamicNByage0[1,1,1,]))
library(Rceattle)
library(Rceattle)
devtools::document()
library(Rceattle)
library(Rceattle)
library(Rceattle)
library(dplyr)
################################################
# Data
################################################
# Example
# To run the 2017 single species assessment for the Bering Sea, a data file must first be loaded:
data(BS2017SS) # ?BS2017SS for more information on the data
BS2017SS$projyr <- 2060
data("BS2017MS") # Note: the only difference is the residual mortality (M1_base) is lower
BS2017MS$projyr <- 2060
BS2017SS$fleet_control$proj_F_prop <-rep(1,7)
BS2017MS$fleet_control$proj_F_prop <- rep(1, 7)
################################################
# Estimate OMs
################################################
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1,
initMode = 2)
# -- NPFMC Tier 3
ss_run_Tier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params,
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
ss_run_dynamicTier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params, # Initial parameters from ss_run
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
DynamicHCR = TRUE, # Use dynamic reference points
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
plot_depletionSSB(list(ss_run, ss_run_dynamicTier3, ss_run_Tier3))
plot_depletionSSB(list(ss_run, ss_run_Tier3))
plot_depletionSSB(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3))
plot_depletionSSB(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3))
plot_ssb(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3))
plot_ssb(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3), incl_proj = TRUE)
plot_ssb(list(ss_run, ss_run_Tier3), incl_proj = TRUE)
plot_ssb(list(ss_run_dynamicTier3, ss_run, ss_run_Tier3, ss_run_dynamicTier3), incl_proj = TRUE)
plot_ssb(list(ss_run_dynamicTier3, ss_run, ss_run_Tier3), incl_proj = TRUE)
check <- ss_run_dynamicTier3
check$quantities$biomassSSB <- check$quantities$DynamicSB0
plot_ssb(list(ss_run, ss_run_Tier3, check), incl_proj = TRUE)
library(Rceattle)
library(Rceattle)
library(dplyr)
################################################
# Data
################################################
# Example
# To run the 2017 single species assessment for the Bering Sea, a data file must first be loaded:
data(BS2017SS) # ?BS2017SS for more information on the data
BS2017SS$projyr <- 2060
data("BS2017MS") # Note: the only difference is the residual mortality (M1_base) is lower
BS2017MS$projyr <- 2060
BS2017SS$fleet_control$proj_F_prop <-rep(1,7)
BS2017MS$fleet_control$proj_F_prop <- rep(1, 7)
################################################
# Estimate OMs
################################################
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1,
initMode = 2)
# -- NPFMC Tier 3
ss_run_Tier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params,
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
ss_run_dynamicTier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params, # Initial parameters from ss_run
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
DynamicHCR = TRUE, # Use dynamic reference points
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
plot_depletionSSB(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3))
plot_ssb(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3), incl_proj = TRUE)
check <- ss_run_dynamicTier3
check$quantities$biomassSSB <- check$quantities$DynamicSB0
plot_ssb(list(ss_run, ss_run_Tier3, check), incl_proj = TRUE)
plot_ssb(list(ss_run, ss_run_Tier3, check, ss_run_dynamicTier3), incl_proj = TRUE)
plot_depletionSSB(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3))
plot_depletionSSB(list(ss_run, ss_run_Tier3, ss_run_dynamicTier3), incl_proj = TRUE)
library(Rceattle)
library(Rceattle)
library(dplyr)
################################################
# Data
################################################
# Example
# To run the 2017 single species assessment for the Bering Sea, a data file must first be loaded:
data(BS2017SS) # ?BS2017SS for more information on the data
BS2017SS$projyr <- 2060
data("BS2017MS") # Note: the only difference is the residual mortality (M1_base) is lower
BS2017MS$projyr <- 2060
BS2017SS$fleet_control$proj_F_prop <-rep(1,7)
BS2017MS$fleet_control$proj_F_prop <- rep(1, 7)
################################################
# Estimate OMs
################################################
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = "default",
verbose = 1,
initMode = 2)
# -- NPFMC Tier 3
ss_run_Tier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params,
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
ss_run_dynamicTier3 <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params, # Initial parameters from ss_run
estimateMode = 0, # Run projection only
HCR = build_hcr(HCR = 5, # Tier3 HCR
DynamicHCR = TRUE, # Use dynamic reference points
FsprTarget = 0.4, # F40%
FsprLimit = 0.35, # F35%
Plimit = c(0.2, 0.2, 0), # No fishing when SB<SB20
Alpha = 0.05),
msmMode = 0, # Single species mode
verbose = 1,
initMode = 2)
ss_run_dynamicTier3$quantities$DynamicNByage0[1,1,1,1:10]
ss_run_dynamicTier3$quantities$R[1,1:10]
ss_run_Tier3$quantities$SPRtarget
library(Rceattle)
