data_list$Ftarget = extend_length(HCR$Ftarget)
} else {
data_list$Ftarget = HCR$Ftarget
}
data_list$Flimit = extend_length(HCR$Flimit)
data_list$Ptarget = extend_length(HCR$Ptarget)
data_list$Plimit = extend_length(HCR$Plimit)
data_list$Alpha = extend_length(HCR$Alpha)
data_list$Pstar = extend_length(HCR$Pstar)
data_list$Sigma = extend_length(HCR$Sigma)
data_list$Fmult = extend_length(HCR$Fmult)
data_list$HCRorder = extend_length(HCR$HCRorder)
data_list$QnormHCR = qnorm(data_list$Pstar, 0, data_list$Sigma)
# if(data_list$HCR == 2 & estimateMode == 2){estimateMode = 4} # If projecting under constant F, run parmeters through obj only
if(data_list$msmMode > 0 & !data_list$HCR %in% c(0, 1, 2, 3, 6)){
warning("WARNING:: Only HCRs 1, 2, 3, and 6 work in multi-species mode currently")
}
# Fill out switches if missing
data_list <- Rceattle::switch_check(data_list)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# 2: Load/build parameters ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
if (is.character(inits) | is.null(inits)) {
start_par <- suppressWarnings(Rceattle::build_params(data_list = data_list))
} else{
start_par <- inits
# - Set F for years with 0 catch to very low number
zero_catch <- data_list$catch_data %>%
dplyr::filter(Year <= data_list$endyr &
Catch == 0) %>%
dplyr::mutate(Year = Year - data_list$styr + 1) %>%
dplyr::select(Fleet_code, Year) %>%
as.matrix()
start_par$ln_F[zero_catch] <- -999
rm(zero_catch)
# Update proj F prop
start_par$proj_F_prop <- data_list$fleet_control$proj_F_prop
}
mod_objects$initial_params <- start_par
if(verbose > 0) {message("Step 1: Parameter build complete")}
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# 3: Load/build map ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
if (is.null(map)) {
map <- suppressWarnings(build_map(data_list, start_par, debug = estimateMode %in% c(2, 4), # Turn off hindcast parameters if debugging or projection mode
random_rec = random_rec, random_sel = random_sel))
} else{
map <- map
}
if(verbose > 0) {message("Step 2: Map build complete")}
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# 4: Get bounds ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
if (is.null(bounds)) {
bounds <- Rceattle::build_bounds(param_list = start_par, data_list)
} else {
bounds = bounds
}
if(verbose > 0) {message("Step 3: Parameter bounds complete")}
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# 5: Setup random effects ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Turns on laplace approximation
random_vars <- c()
if (random_rec) {
if(initMode > 0){
random_vars <- c(random_vars , "rec_dev", "init_dev")
} else{
random_vars <- c(random_vars , "rec_dev")
}
}
if(random_q){
random_vars <- c(random_vars , "index_q_dev")
}
if(random_sel){
random_vars <- c(random_vars , "ln_sel_slp_dev", "sel_inf_dev", "sel_coff_dev")
}
if(sum(data_list$M1_re) > 0){
random_vars <- c(random_vars, "ln_M1_dev")
}
TMBfilename <- "ceattle_v01_11"
# - Check for data errors
Rceattle:::data_check(data_list)
# - Reorganize data for .cpp file
data_list_reorganized <- Rceattle::rearrange_dat(data_list)
# Data dimensions
max_sex <- max(data_list$nsex, na.rm = T)
max_age <- max(data_list$nages, na.rm = T)
max_length <- max(data_list$nlengths, na.rm = T)
yrs_hind <- data_list$styr:data_list$endyr
yrs_proj <- data_list$styr:data_list$projyr
nyrs_hind <- length(yrs_hind)
nyrs_proj <- length(yrs_proj)
# 1 - Fleet control ----
# - 0) Vector to save  species
data_list$flt_spp <- data_list$fleet_control %>%
dplyr::pull(Species) %>% as.integer() - 1
# - 1) Fleet pointer
data_list$flt_sel_ind <- data_list$fleet_control %>%
dplyr::pull(Fleet_code) %>% as.integer() - 1
# - 2) Fleet type; 0 = don't fit, 1 = fishery, 2 = survey
data_list$flt_type <- data_list$fleet_control %>%
dplyr::pull(Fleet_type) %>% as.integer()
# - 3) Month of observation
data_list$flt_month <- data_list$fleet_control %>%
dplyr::pull(Month)
# - 4) Selectivity type
data_list$flt_sel_type <- data_list$fleet_control %>%
dplyr::pull(Selectivity) %>% as.integer()
# - 5) Number of ages/lengths for non-parametric selectivity
data_list$flt_n_sel_bins <- data_list$fleet_control %>%
dplyr::mutate(N_sel_bins = ifelse(is.na(N_sel_bins), -999, N_sel_bins)) %>%
dplyr::pull(N_sel_bins) %>% as.integer()
# - 6) Time-varying selectivity type.
data_list$flt_varying_sel <- data_list$fleet_control %>%
dplyr::pull(Time_varying_sel) %>% as.integer()
# - 7) First age selected
data_list$bin_first_selected <- data_list$fleet_control %>%
dplyr::mutate(Bin_first_selected = Bin_first_selected - 1, # R to C++ indexing
Bin_first_selected = ifelse(is.na(Bin_first_selected), 0, Bin_first_selected)) %>%
dplyr::pull(Bin_first_selected) %>% as.integer()
# - 8) Age of max selectivity (used for normalization). If NA, does not normalize
data_list$sel_norm_bin1 <- data_list$fleet_control %>%
dplyr::mutate(
Sel_norm_bin1 = Sel_norm_bin1 - data_list$minage[Species],
Sel_norm_bin1 = ifelse(Sel_norm_bin1 < 0, -99, Sel_norm_bin1),         # Less than zero, normalize by max
Sel_norm_bin1 = ifelse(is.na(Sel_norm_bin1), -999, Sel_norm_bin1)) %>% # NA, do not normalize (unless type = 2)
dplyr::pull(Sel_norm_bin1) %>% as.integer()
# - 9) upper age of max selectivity (used for normalization). If NA, does not normalize
data_list$sel_norm_bin2 <- data_list$fleet_control %>%
dplyr::mutate(Sel_norm_bin2 = Sel_norm_bin2 - data_list$minage[Species],
Sel_norm_bin2 = ifelse(is.na(Sel_norm_bin2), -999, Sel_norm_bin2)) %>%
dplyr::pull(Sel_norm_bin2) %>% as.integer()
# - 10) Index indicating wether to do dirichlet multinomial or a multinomial
data_list$comp_ll_type <- data_list$fleet_control %>%
dplyr::pull(Comp_loglike) %>% as.integer()
data_list$caal_ll_type <- data_list$fleet_control %>%
dplyr::pull(CAAL_loglike) %>% as.integer()
# - 11) Index units (1 = weight, 2 = numbers)
data_list$flt_units <- data_list$fleet_control %>%
dplyr::pull(Weight1_Numbers2) %>% as.integer()
# - 12) Dim1 of weight (what weight-at-age data set)
data_list$flt_wt_index <- data_list$fleet_control %>%
dplyr::pull(Weight_index) %>% as.integer() - 1
# - 13) Dim3 of age transition matrix (what ALK to use)
data_list$flt_age_transition_index <- data_list$fleet_control %>%
dplyr::pull(Age_transition_index) %>% as.integer() - 1
# - 14) Parametric form of q
data_list$est_index_q <- data_list$fleet_control %>%
dplyr::pull(Catchability) %>% as.integer()
# - 15) Time varying q type
data_list$index_varying_q <- data_list$fleet_control %>%
dplyr::pull(Time_varying_q) %>% as.integer()
# - 16) Wether to estimate standard deviation of index time series
data_list$est_sigma_index <- data_list$fleet_control %>%
dplyr::pull(Estimate_index_sd) %>% as.integer()
# - 17) Wether to estimate standard deviation of fishery time series
data_list$est_sigma_fsh <- data_list$fleet_control %>%
dplyr::pull(Estimate_catch_sd) %>% as.integer()
data_list$index_ln_q_prior <- log(data_list$fleet_control$Q_prior)
# Species names
data_list$spnames <- NULL
# * F reference points ----
data_list$Ftarget_percent <- data_list$Ftarget
data_list$Flimit_percent <- data_list$Flimit
# 2 -  Index data ----
# - Seperate index metadata from observation
data_list$index_ctl <- data_list$index_data %>%
dplyr::select(Fleet_code, Species, Year) %>%
dplyr::mutate_all(as.integer)
data_list$index_n <- as.matrix(data_list$index_data[,c("Month")])
data_list$index_obs <- data_list$index_data %>%
dplyr::select(Observation, Log_sd) %>%
dplyr::mutate_all(as.numeric)
# 3 -  Catch data ----
# - Seperate catch metadata from observation
data_list$catch_ctl <- data_list$catch_data %>%
dplyr::select(Fleet_code, Species, Year) %>%
dplyr::mutate_all(as.integer)
data_list$catch_n <- as.matrix(data_list$catch_data[,c("Month")])
data_list$catch_obs <- data_list$catch_data %>%
dplyr::select(Catch, Log_sd) %>%
dplyr::mutate_all(as.numeric)
# 4 -  Comp data ----
# - Seperate comp metadata from observation
data_list$comp_ctl <- data_list$comp_data %>%
dplyr::select(Fleet_code, Species, Sex, Age0_Length1, Year) %>%
dplyr::mutate_all(as.integer)
data_list$comp_n <- data_list$comp_data %>%
dplyr::select(Month, Sample_size) %>%
dplyr::mutate_all(as.numeric)
data_list$comp_obs <- data_list$comp_data %>%
dplyr::select(contains("Comp_")) %>%
dplyr::mutate_all(as.numeric) %>%
as.matrix()
if(nrow(data_list$comp_obs) > 0){ #FIXME: probably cleaner way to deal with this
data_list$comp_obs <- t(apply(data_list$comp_obs, 1, function(x) as.numeric(x) / sum(as.numeric(x), na.rm = TRUE))) # Normalize
data_list$comp_obs[is.infinite(data_list$comp_obs)] <- 0
data_list$comp_obs[is.na(data_list$comp_obs)] <- 0
}
data_list <- check_composition_data(data_list)
# 5 - CAAL data ----
data_list$caal_ctl <- data_list$caal_data %>%
dplyr::mutate(Length_bin = factor(Length)) %>%
dplyr::select(Fleet_code, Species, Sex, Year, Length_bin) %>%
dplyr::mutate_all(as.integer)
data_list$caal_n <- data_list$caal_data %>%
dplyr::select(Sample_size) %>%
dplyr::mutate_all(as.numeric)
data_list$caal_obs <- data_list$caal_data %>%
dplyr::select(contains("CAAL_")) %>%
dplyr::mutate_all(as.numeric) %>%
as.matrix()
if(nrow(data_list$caal_obs) > 0){#FIXME: probably cleaner way to deal with this
data_list$caal_obs <- t(apply(data_list$caal_obs, 1, function(x) as.numeric(x) / sum(as.numeric(x), na.rm = TRUE))) # Normalize
data_list$caal_obs[is.infinite(data_list$caal_obs)] <- 0
data_list$caal_obs[is.na(data_list$caal_obs)] <- 0
}
data_list <- check_caal_data(data_list)
# * Get lengths from CAAL ----
data_list$lengths <- matrix(rep(1:max(data_list$nlengths), data_list$nspp), nrow = data_list$nspp, byrow = TRUE)
data_list$lengths
if(nrow(data_list$caal_data) > 0){
caal_lengths <- data_list$caal_data %>%
dplyr::distinct(Species, Length) %>%
dplyr::arrange(Species, Length) %>%
dplyr::group_by(Species) %>%
dplyr::mutate(Bin = paste0("Bin", 1:n())) %>%
tidyr::pivot_wider(names_from = Bin, values_from = Length)
data_list$lengths[caal_lengths$Species, 1:ncol(caal_lengths[,-1])] <- as.matrix(caal_lengths[,-1])
# - Check to make sure n-bins in data match nlengths
n_bins_data <- data_list$caal_data %>%
dplyr::distinct(Species, Length) %>%
dplyr::count(Species)
if(data_list$nlengths[n_bins_data$Species] != n_bins_data$n){
stop("Number of length bins in CAAL data does not match nlengths in control file.
If some lengths are missing from CAAL data, please add them to the data
as rows of all 1s with Sample_size = 0")
}
}
caal_lengths <- data_list$caal_data %>%
dplyr::distinct(Species, Length) %>%
dplyr::arrange(Species, Length) %>%
dplyr::group_by(Species) %>%
dplyr::mutate(Bin = paste0("Bin", 1:n())) %>%
tidyr::pivot_wider(names_from = Bin, values_from = Length)
data_list$lengths[caal_lengths$Species, 1:ncol(caal_lengths[,-1])] <- as.matrix(caal_lengths[,-1])
data_list$lengths
# - Check to make sure n-bins in data match nlengths
n_bins_data <- data_list$caal_data %>%
dplyr::distinct(Species, Length) %>%
dplyr::count(Species)
n_bins_data
n_bins_data$n
data_list$nlengths[n_bins_data$Species]
if(data_list$nlengths[n_bins_data$Species] != n_bins_data$n){
stop("Number of length bins in CAAL data does not match nlengths in control file.
If some lengths are missing from CAAL data, please add them to the data
as rows of all 1s with Sample_size = 0")
}
source("~/Documents/GitHub/Rceattle/R/5-rearrange_data.R", echo = TRUE)
# - Reorganize data for .cpp file
data_list_reorganized <- Rceattle::rearrange_dat(data_list)
# - Reorganize data for .cpp file
data_list_reorganized <- rearrange_dat(data_list)
# Example fitting internal growth via a von Bertalanffy function in Rceattle
# Includes CAAL data
# - this follows Giancarlo's example in WHAM (https://giancarlomcorrea.netlify.app/labs/OFI_WK_2023/examples/case3.R)
# - from his time-varying growth workshop (https://giancarlomcorrea.netlify.app/post/ofi-workshop/).
# - I modified the models so that all fleets use length-based logistic selectivity.
# - see "tests/comparison/WHAM growth comparison.R" for full comparison
library(Rceattle)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Data ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# To run model we use data from Giancarlo's class formatted for Rceattle:
# - see line 134 of "tests/comparison/WHAM growth comparison.R" for modification
data(whamGrowthData)
# The model includes conditional-age-at-length data for the survey
# - The lengths from the caal data will be used for growth estimation
# - if the number of lengths in the caal_data for each species does not match "data$nlengths" it will produce an error.
head(whamGrowthData$caal_data)
# - To convert length-at-age to weight-at-age Rceattle uses time- and sex-invariant power equation: W = a * L ^ b
# - with parameters specified in the data for each species
whamGrowthData$alpha_wt_len
whamGrowthData$beta_wt_len
# - The month of spawning and a survey/fishery occurs is also specified in the data
whamGrowthData$spawn_month         # Spawning
whamGrowthData$fleet_control$Month # Fleets
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Estimation ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# To estimate growth we can set "growthFun" using switches in "build_growth"
# See "?build_growth" for all details
vbgf_model <- Rceattle::fit_mod(data_list = whamGrowthData,
inits = NULL,       # Initial parameters at default
estimateMode = 0,   # Estimate
growthFun = build_growth(growth_model = 1), # Von Bert
random_rec = FALSE, # No random recruitment
msmMode = 0,        # Single species mode
phase = FALSE,
initMode = 2,       # Unfished disequilibrium
verbose = 1)
richards_model <- Rceattle::fit_mod(data_list = whamGrowthData,
inits = NULL,       # Initial parameters at default
estimateMode = 0,   # Estimate
growthFun = build_growth(growth_model = 2), # Richards
random_rec = FALSE, # No random recruitment
msmMode = 0,        # Single species mode
phase = FALSE,
initMode = 2,       # Unfished disequilibrium
verbose = 1)
# Growth functions can be species specific
# We can combine the dataset to demonstrate
double_data <- combine_data(whamGrowthData, whamGrowthData)
double_data$spnames <- c(1,2)
double_model <- Rceattle::fit_mod(data_list = double_data,
inits = NULL,       # Initial parameters at default
estimateMode = 0,   # Estimate
growthFun = build_growth(growth_model = c(1,2)), # Richards
random_rec = FALSE, # No random recruitment
msmMode = 0,        # Single species mode
phase = FALSE,
initMode = 2,       # Unfished disequilibrium
verbose = 1)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Plot and compare ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
plot_biomass(list(vbgf_model, richards_model), model_names = c("VBGF", "Richards"), incl_proj = TRUE)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Plot and compare ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
plot_biomass(list(vbgf_model, richards_model, double_model), model_names = c("VBGF", "Richards"), incl_proj = TRUE)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Plot and compare ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
plot_biomass(list(vbgf_model, richards_model, double_model), species = 1, model_names = c("VBGF", "Richards"), incl_proj = TRUE)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Plot and compare ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
plot_biomass(list(double_model, vbgf_model, richards_model), species = 1, model_names = c("VBGF", "Richards"), incl_proj = TRUE)
double_model <- Rceattle::fit_mod(data_list = double_data,
inits = NULL,       # Initial parameters at default
estimateMode = 0,   # Estimate
growthFun = build_growth(growth_model = c(1,2)), # Richards
random_rec = FALSE, # No random recruitment
msmMode = 0,        # Single species mode
phase = TRUE,
initMode = 2,       # Unfished disequilibrium
verbose = 1)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Plot and compare ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
plot_biomass(list(double_model, vbgf_model, richards_model), species = 1, model_names = c("VBGF", "Richards"), incl_proj = TRUE)
double_model$data_list$growth_model
double_model <- Rceattle::fit_mod(data_list = double_data,
inits = NULL,       # Initial parameters at default
estimateMode = 0,   # Estimate
growthFun = build_growth(growth_model = c(1,1)), # Richards
random_rec = FALSE, # No random recruitment
msmMode = 0,        # Single species mode
phase = TRUE,
initMode = 2,       # Unfished disequilibrium
verbose = 1)
?build_hcr
library(Rceattle)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Data ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Example
# To run the 2017 single species assessment for the Bering Sea, a data file must first be loaded:
data(BS2017SS) # ?BS2017SS for more information on the data
BS2017SS$projyr <- 2060
BS2017SS$fleet_control$proj_F_prop <-rep(1,7)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Operating Models ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Single-species with fixed M
ss_run <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = TRUE,
verbose = 1)
# Single-species with fixed M with Ricker curve
ss_run_ricker <- Rceattle::fit_mod(data_list = BS2017SS,
inits = NULL, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
phase = TRUE,
verbose = 1,
recFun = build_srr(srr_fun = 0,
srr_pred_fun = 4, # Ricker (but fit sensu Ianelli)
proj_mean_rec = FALSE,
srr_est_mode = 1
)
)
#  Single-species with estimated M
ss_run_M <- Rceattle::fit_mod(data_list = BS2017SS,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
random_rec = FALSE, # No random recruitment
M1Fun = build_M1(M1_model = 1),
msmMode = 0, # Single species mode
phase = TRUE,
verbose = 1)
# Multispecies model
data("BS2017MS") # Note: the only difference is the residual mortality (M1_base) is lower
BS2017MS$projyr <- 2060
BS2017MS$fleet_control$proj_F_prop <-rep(1,7)
ms_run <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 1, # Estimate hindcast only
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
M1Fun = build_M1(updateM1 = TRUE), # Fix residual M to values in data
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
# Plot OMs:
mod_list <- list(ss_run, ss_run_M, ms_run)
mod_names <- c("SS", "SS-M", "MS")
plot_biomass(Rceattle = mod_list, model_names = mod_names)
plot_recruitment(Rceattle = mod_list, model_names = mod_names, add_ci = TRUE)
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Multi-species harvest control rules ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# -- F that acheives 40% of SB0, where SB0 is derived from projecting all species simultaneously under no fishing
ms_run_fb40 <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 0, # Estimate hindcast only
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
HCR = build_hcr(HCR = 3, # Constant F HCR
DynamicHCR = FALSE, # Use dynamic reference points
Ftarget = 0.4), # F that achieves 40% SB0
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
# -- F that acheives 40% of SB0, where SB0 is derived from first projecting arrowtooth and cod under no fishing, then projecting pollock under no fishing and cod/arrowtooth at SB40.
ms_run_fb40iter <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 0, # Estimate hindcast only
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
HCR = build_hcr(HCR = 3, # Constant F HCR
DynamicHCR = FALSE, # Use dynamic reference points
Ftarget = 0.4,
HCRorder = c(2,1,1)), # F that achieves 40% SB0
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
# -- Multi-species CMSY
ms_run_cmsy <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 0, # Estimate hindcast only
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
HCR = build_hcr(HCR = 1),
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
# -- Multi-species CMSY, constrained so that species don't fall below 20% SB0
# -- SB0 is derived from projecting all species simultaneously under no fishing
ms_run_concmsy <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 0, # Estimate hindcast only
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
HCR = build_hcr(HCR = 1,
Plimit = 0.35),
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
# -- Plot
mod_list <- list(ms_run_fb40, ms_run_concmsy)
# -- Plot
mod_list <- list(ms_run_fb40, ms_run_concmsy)
model_names <- c("MS-F40", "Constrained MS-MSY")
plot_biomass(mod_list, model_names = model_names, incl_proj = TRUE)
# -- Multi-species CMSY, constrained so that species don't fall below 20% SB0
# -- SB0 is derived from projecting all species simultaneously under no fishing
ms_run_concmsy <- Rceattle::fit_mod(data_list = BS2017MS,
inits = ss_run_M$estimated_params, # Initial parameters from single species ests
file = NULL, # Don't save
estimateMode = 0, # Estimate hindcast only
niter = 3, # 10 iterations around population and predation dynamics
random_rec = FALSE, # No random recruitment
HCR = build_hcr(HCR = 1,
Plimit = 0.30),
msmMode = 1, # MSVPA based
suitMode = 0, # empirical suitability
verbose = 1)
# -- Plot
mod_list <- list(ms_run_fb40, ms_run_concmsy)
model_names <- c("MS-F40", "Constrained MS-MSY")
plot_biomass(mod_list, model_names = model_names, incl_proj = TRUE)
# -- Plot
mod_list <- list(ms_run_fb40, ms_run_concmsy)
model_names <- c("MS-F40", "Constrained MS-MSY")
plot_biomass(mod_list, model_names = model_names, incl_proj = TRUE, species = 1)
plot_biomass(mod_list, model_names = model_names, incl_proj = TRUE, species = 1)
