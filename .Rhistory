Pred_sex = 0,
Prey_sex = 0,
Sample_size = 200
)
ms_run6 <- Rceattle::fit_mod(data_list = simData,
inits = ss_run$estimated_params, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 0, # Estimate
random_rec = FALSE, # No random recruitment
phase = FALSE,
msmMode = 1,
niter = 5,
suitMode = 4,
initMode = 2,
verbose = 1)
plot(x = sim$Total_Biom[1,], y = ms_run6$quantities$biomass[1,1:nyrs]); abline(0,1)
plot(x = sim$Total_Biom[2,], y = ms_run6$quantities$biomass[2,1:nyrs]); abline(0,1)
# Plot diet results
plot(
x = ms_run6$data_list$diet_data$Stomach_proportion_by_weight,
y = ms_run6$quantities$diet_hat[,2],
xlab = "True Diet Proportion (Simulated)",
ylab = "Est Diet Proportion (Modeled)",
main = "Fit for Prey-summed Predator Average Diet Data"
)
abline(0, 1)
################################
##plot single species models
mod_list <- list(ss_run, ms_run1, ms_run2, ms_run3, ms_run4, ms_run5, ms_run6)
mod_names <- c("ss_run", "ms_run1", "ms_run2", "ms_run3", "ms_run4", "ms_run5", "ms_run6")
# Plot biomass trajectory
plot_biomass(Rceattle = mod_list, model_names = mod_names) #Now biomass looks alike
plot_biomass(Rceattle = mod_list, model_names = mod_names, add_ci = TRUE)
plot_depletionSSB(Rceattle = mod_list, model_names = mod_names) #this looks pretty different
plot_ssb(Rceattle = mod_list, model_names = mod_names, add_ci = TRUE)
plot_b_eaten_prop(Rceattle = mod_list, model_names = mod_names)
ms_run2$estimated_params$diet_comp_weights #1,1
ms_run2$data_list$Diet_weights_mcallister
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
library(dplyr)
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
data_list = GOA2018SS;
inits = NULL;
map = NULL;
bounds = NULL;
file = NULL;
estimateMode = 0;
random_rec = FALSE;
random_q = FALSE;
random_sel = FALSE;
HCR = build_hcr();
niter = 3;
msmMode = 0;
avgnMode = 0;
initMode = 2
minNByage = 0;
suitMode = 0;
suit_styr = NULL;
suit_endyr = NULL;
phase = FALSE;
getsd = TRUE;
use_gradient = TRUE;
rel_tol = 1;
control = list(eval.max = 1e+09,
iter.max = 1e+09, trace = 0);
getJointPrecision = TRUE;
loopnum = 5;
verbose = 1;
newtonsteps = 0
recFun = build_srr()
M1Fun = build_M1()
projection_uncertainty = TRUE
catch_hcr = FALSE
bias.correct = FALSE
newtonsteps = 0
getReportCovariance = FALSE
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# 0 - Start ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
mod_objects <- list() # Objects for saving
start_time <- Sys.time()
extend_length <- function(x){
if(length(x) == data_list$nspp){ return(x)}
else {return(rep(x, data_list$nspp))}
}
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# 1 - Load data and switches ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
if (is.null(data_list)) {
stop("Missing data_list object")
}
data_list <- Rceattle::clean_data(data_list)
# Add switches from function call
data_list$random_rec <- as.numeric(random_rec)
data_list$estimateMode <- estimateMode
data_list$niter <- niter
data_list
# Transpose fleet control
data_list <- Rceattle::transpose_fleet_control(data_list)
data_list
# Remove years of data previous to start year and after end year
# - Data in likelihood
data_list$index_data <- data_list$index_data %>%
dplyr::filter(abs(Year) >= data_list$styr & abs(Year) <= data_list$projyr)
data_list$catch_data <- data_list$catch_data %>%
dplyr::filter(abs(Year) >= data_list$styr & abs(Year) <= data_list$projyr)
data_list$comp_data <- data_list$comp_data %>%
dplyr::filter(abs(Year) >= data_list$styr & abs(Year) <= data_list$projyr)
data_list$diet_data <- data_list$diet_data %>%
dplyr::filter(Year >= data_list$styr & Year <= data_list$projyr | Year == 0) %>%
dplyr::arrange(Pred, Pred_sex, Pred_age, Prey, Prey_sex, Prey_age, Year)
# - Fixed data
data_list$weight <- data_list$weight %>%
dplyr::filter(Year >= data_list$styr & Year <= data_list$projyr | Year == 0)
data_list$diet_data <- as.data.frame(data_list$diet_data) %>%
dplyr::filter(Year >= data_list$styr & Year <= data_list$projyr | Year == 0)
data_list$emp_sel <- data_list$emp_sel %>%
dplyr::filter(Year >= data_list$styr & Year <= data_list$projyr | Year == 0)
data_list$NByageFixed <- data_list$NByageFixed %>%
dplyr::filter(Year >= data_list$styr & Year <= data_list$projyr | Year == 0)
data_list$ration_data <- data_list$ration_data %>%
dplyr::filter(Year >= data_list$styr & Year <= data_list$projyr | Year == 0)
data("GOAatf")
data_list <- GOAatf
# if(any(data_list$fleet_control$Selectivity == 2 & data_list$fleet_control$Time_varying_sel > 1)){
#   data_list$fleet_control <- data_list$fleet_control %>%
#       dplyr::mutate(Sel_curve_pen1 = ifelse(Selectivity == 2 & Time_varying_sel > 1, Time_varying_sel, NA),
#                     Sel_curve_pen2 = ifelse(Selectivity == 2 & Time_varying_sel > 1, Sel_sd_prior, 0),
#                     Time_varying_sel = ifelse(Selectivity == 2 & Time_varying_sel > 1, 0, Time_varying_sel),
#                     Sel_sd_prior = ifelse(Selectivity == 2 & Time_varying_sel > 1, 0, Sel_sd_prior)
#
#       ) %>%
#     dplyr::relocate(Sel_curve_pen1, .after = Nselages) %>%
#     dplyr::relocate(Sel_curve_pen2, .after = Sel_curve_pen1)
#   print("Updating format where 'Selectivity == 2'. Moving non-parametric penalties to 'Sel_curve_pen1' and 'Sel_curve_pen2'.")
# }
# data_list$fleet_control <- data_list$fleet_control %>%
# dplyr::mutate(Time_varying_sel = 0, Sel_sd_prior = 0) %>%
#   dplyr::relocate(Sel_curve_pen1, .after = Nselages) %>%
#   dplyr::relocate(Sel_curve_pen2, .after = Sel_curve_pen1)
# data_list$R_sexr <- NULL
# data_list$est_sex_ratio <- NULL
# data_list$sex_ratio_sigma <- NULL
# data_list$aLW <- NULL
# data_list$maturity <- data_list$pmature
# data_list$pmature <- NULL
# data_list$weight <- data_list$wt
# data_list$wt <- NULL
#
# data_list$diet_data <- data_list$stom_prop_data
# data_list$stom_prop_data <- NULL
#
# ss_run <- Rceattle::fit_mod(data_list = data_list,
#                             inits = NULL, # Initial parameters = 0
#                             file = NULL, # Don't save
#                             estimateMode = 0, # Estimate
#                             random_rec = FALSE, # No random recruitment
#                             msmMode = 0, # Single species mode
#                             phase = TRUE,
#                             verbose = 1)
# plot_biomass(ss_run)
data_list$ration_data <- data_list$Pyrs
data_list$Pyrs <- NULL
GOAatf <- data_list
usethis::use_data(GOAatf, overwrite = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
data("GeorgesBank3spp")
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
source("~/Documents/GitHub/Rceattle/R/dev/data updates.R", echo = TRUE)
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/max(sel[1:10]), tolerance = 0.0001))
library(testthat)
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/max(sel[1:10]), tolerance = 0.0001))
# - ATF
apply(ss_run$quantities$sel[9,1,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/max(c(sel, sel2)), tolerance = 0.0001))
apply(ss_run$quantities$sel[9,2,1:21,], 2, function(x) expect_equal(as.numeric(x), sel2[1:21]/max(c(sel, sel2)), tolerance = 0.0001))
ss_run$quantities$sel[9,2,1:21,]
ss_run$quantities$sel[1,1,1:10,]
sel[1:10]/max(sel[1:10])
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/max(sel[1:10]), tolerance = 0.0001))
# - ATF
apply(ss_run$quantities$sel[9,1,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/max(c(sel, sel2)), tolerance = 0.0001))
apply(ss_run$quantities$sel[9,2,1:21,], 2, function(x) expect_equal(as.numeric(x), sel2[1:21]/max(c(sel, sel2)), tolerance = 0.0001))
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/max(sel[1:10]), tolerance = 0.0001))
library(testthat)
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/max(sel[1:10]), tolerance = 0.0001))
# - ATF
apply(ss_run$quantities$sel[9,1,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/max(c(sel, sel2)), tolerance = 0.0001))
apply(ss_run$quantities$sel[9,2,1:21,], 2, function(x) expect_equal(as.numeric(x), sel2[1:21]/max(c(sel, sel2)), tolerance = 0.0001))
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 13; alpha = 0.2
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
sel2 <- 1/(1+exp(-alpha*(ages-inf-1)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf     # Females
inits$sel_inf[1,9:11,2] <- inf + 1 # Males
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- NA
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10], tolerance = 0.0001))
# - ATF
apply(ss_run$quantities$sel[9,1,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21], tolerance = 0.0001))
apply(ss_run$quantities$sel[9,2,1:21,], 2, function(x) expect_equal(as.numeric(x), sel2[1:21], tolerance = 0.0001))
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- 7
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/sel[7], tolerance = 0.0001))
# - ATF
apply(ss_run$quantities$sel[9,1,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/sel[7], tolerance = 0.0001))
apply(ss_run$quantities$sel[9,2,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/sel[7], tolerance = 0.0001))
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
inf = 10; alpha = 0.5
ages <- 1:21
sel <- 1/(1+exp(-alpha*(ages-inf)))
curve(1/(1+exp(-alpha*(x-inf))), from = 0, to = 21)
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- 7
GOA2018SS$fleet_control$Age_max_selected_upper <- 9
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
apply(ss_run$quantities$sel[1,1,1:10,], 2, function(x) expect_equal(as.numeric(x), sel[1:10]/mean(sel[7:9]), tolerance = 0.0001))
# - ATF
apply(ss_run$quantities$sel[9,1,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/mean(sel[7:9]), tolerance = 0.0001))
apply(ss_run$quantities$sel[9,2,1:21,], 2, function(x) expect_equal(as.numeric(x), sel[1:21]/mean(sel[7:9]), tolerance = 0.0001))
library(Rceattle)
data("GOA2018SS") # Single-species data. ?BS2017SS for more information on the data
inits <- build_params(GOA2018SS)
# Specify logistic selectivity
nyrs <- GOA2018SS$styr:GOA2018SS$endyr
inf = 10
inf_dev <- rnorm(nyrs)
ln_slp_dev <- rnorm(nyrs)
alpha = 0.5
ages <- 1:21
sel <- apply(cbind(ln_slp_dev, inf_dev), 1, function(x) 1/(1+exp(-alpha*exp(x[1]) * (ages - inf - x[2]))))
# Set params to logistic
inits$ln_sel_slp[1,,] <- log(alpha)
inits$sel_inf[1,,] <- inf
for(i in 1:dim(inits$ln_sel_slp_dev[1,,,])[1]){
for(j in 1:dim(inits$ln_sel_slp_dev[1,,,])[2]){
inits$ln_sel_slp_dev[1,i,j,] <- ln_slp_dev
inits$sel_inf_dev[1,i,j,] <- inf_dev
}
}
GOA2018SS$fleet_control$Selectivity <- 1
GOA2018SS$fleet_control$Time_varying_sel <- 1
GOA2018SS$fleet_control$Sel_sd_prior <- 1
GOA2018SS$fleet_control$Age_first_selected <- 1
GOA2018SS$fleet_control$Age_max_selected <- NA
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
expect_equal(as.numeric(ss_run$quantities$sel[1,1,1:10,1:42]), as.numeric(apply(sel[1:10,], 2, function(x) x/max(x))), tolerance = 0.0001)
ss_run$quantities$sel[9,1,1:21,1:42])
ss_run$quantities$sel[9,1,1:21,1:42]
# - ATF
expect_equal(as.numeric(ss_run$quantities$sel[9,1,1:21,1:42]), as.numeric(apply(sel[1:21,], 2, function(x) x/max(x))), tolerance = 0.0001)
# Check selectivity
# - Pollock
expect_equal(as.numeric(ss_run$quantities$sel[1,1,1:10,1:42]), as.numeric(apply(sel[1:10,], 2, function(x) x/max(x))), tolerance = 0.0001)
ss_run$quantities$sel[1,1,1:10,1:42]
as.numeric(apply(sel[1:10,], 2, function(x) x/max(x)))
apply(sel[1:10,], 2, function(x) x/max(x))
GOA2018SS$fleet_control$Age_max_selected <- -100
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
expect_equal(as.numeric(ss_run$quantities$sel[1,1,1:10,1:42]), as.numeric(apply(sel[1:10,], 2, function(x) x/max(x))), tolerance = 0.0001)
# - ATF
expect_equal(as.numeric(ss_run$quantities$sel[9,1,1:21,1:42]), as.numeric(apply(sel[1:21,], 2, function(x) x/max(x))), tolerance = 0.0001)
expect_equal(as.numeric(ss_run$quantities$sel[9,2,1:21,1:42]), as.numeric(apply(sel[1:21,], 2, function(x) x/max(x))), tolerance = 0.0001)
GOA2018SS$fleet_control$Age_max_selected <- -999
# Run
ss_run <- Rceattle::fit_mod(data_list = GOA2018SS,
inits = inits, # Initial parameters = 0
file = NULL, # Don't save
estimateMode = 3, # Don't estimate
random_rec = FALSE, # No random recruitment
msmMode = 0, # Single species mode
verbose = 1)
# Check selectivity
# - Pollock
expect_equal(as.numeric(ss_run$quantities$sel[1,1,1:10,1:42]), as.numeric(apply(sel[1:10,], 2, function(x) x/max(x))), tolerance = 0.0001)
# - ATF
expect_equal(as.numeric(ss_run$quantities$sel[9,1,1:21,1:42]), as.numeric(apply(sel[1:21,], 2, function(x) x/max(x))), tolerance = 0.0001)
expect_equal(as.numeric(ss_run$quantities$sel[9,2,1:21,1:42]), as.numeric(apply(sel[1:21,], 2, function(x) x/max(x))), tolerance = 0.0001)
ss_run$data_list$fleet_control
