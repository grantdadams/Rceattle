% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5-fit_mod_v2.R
\name{Rceattle}
\alias{Rceattle}
\title{This functions runs CEATTLE}
\usage{
Rceattle(TMBfilename = "ceattle_v01_02", cpp_directory = NULL,
  data_list = NULL, inits = NULL, map = NULL, bounds = NULL,
  file_name = NULL, debug = T, random_rec = FALSE, niter = 3,
  msmMode = 0, avgnMode = 0, suitMode = 0, silent = FALSE,
  recompile = FALSE)
}
\arguments{
\item{TMBfilename}{(Optional) A version of the cpp CEATTLE \code{cpp_directory}. If NULL, uses the deafult and built .cpp file}

\item{cpp_directory}{(Optional) The directory where the cpp file is found}

\item{data_list}{a data_list created from \code{\link{build_dat}}.}

\item{inits}{(Optional) Character vector of named initial values from ADMB or list of previous parameter estimates from Rceattle model. If NULL, will use 0 for starting parameters. Can also consturct using \code{\link{build_params}}}

\item{map}{(Optional) A prebuilt map object from \code{\link{build_map}}.}

\item{bounds}{(Optional) A prebuild bounds object from \code{\link{build_bounds}}.}

\item{file_name}{(Optional) Filename where files will be saved. If NULL, no file is saved.}

\item{debug}{Runs the model without estimating parameters to get derived quantities given initial parameter values.}

\item{random_rec}{logical. If TRUE, treats recruitment deviations as random effects.The default is FALSE.}

\item{niter}{Number of iterations for multispecies model}

\item{msmMode}{The predation mortality functions to used. Defaults to no predation mortality used.}

\item{avgnMode}{The average abundance-at-age approximation to be used for predation mortality equations. 0 (default) is the \eqn{\frac{N}{Z} \left( 1 - exp^{-Z} \right)}, 1 is \eqn{N e^{-Z/2}}, 2 is \eqn{N}.}

\item{suitMode}{Mode for suitability/functional calculation. 0 = empirical based on diet data (Holsman et al. 2015), 1 = length based gamma selectivity from Kinzey and Punt (2009), 2 = time-varing length based gamma selectivity from Kinzey and Punt (2009), 3 = time-varying weight based gamma selectivity from Kinzey and Punt (2009), 4 = length based lognormal selectivity, 5 = time-varing length based lognormal selectivity, 6 = time-varying weight based lognormal selectivity,}

\item{silent}{logical. IF TRUE, includes TMB estimation progress}
}
\value{
A list of class "Rceattle" including:

\itemize{
 \item{data_list: List of data inputs}
 \item{initial_params: List of starting parameters}
 \item{bounds: Parameter bounds used for estimation}
 \item{map: List of map used in TMB}
 \item{obj: TMB model object}
 \item{opt: Optimized model object from `nlimb``}
 \item{sdrep: Object of class `sdreport` exported by TMB including the standard errors of estimated parameters}
 \item{estimated_params: List of estimated parameters}
 \item{quantities: Derived quantities from CEATTLE}
 \item{run_time: Model run time}
 }



`quantities` from the returned `Rceattle` object includes the following:
\itemize{
 \item 1. Population components
 \item mn_rec: Mean recruitment; dim = [1, nspp]
 \item{Zed: Total mortality at age; dim = [nspp, nages, nyrs] }
 \item{NByage: Numbers at age; dim = [nspp, nages, nyrs] }
 \item{AvgN: Average numbers-at-age; dim = [nspp, nages, nyrs] }
 \item{S: Survival at age; dim = [nspp, nages, nyrs] }
 \item{biomassByage: Estimated biomass-at-age (kg); dim = [nspp, nages, nyrs] }
 \item{biomassSSBByage: Spawning biomass at age (kg); dim = [nspp, nages, nyrs] }
 \item{biomass: Estimated biomass (kg); dim = [nspp, nyrs] }
 \item{biomassSSB: Estimated spawning stock biomass (kg); dim = [nspp, nyrs] }
 \item{pmature: Estimated recruitment (n); dim = [nspp, nyrs] }
 \item{r_sigma: Standard deviation of recruitment variation}
 \item{R: Estimated recruitment (n); dim = [nspp, nyrs] }
 \item{M1: Base natural mortality; dim = [nspp, nages] }
 \item{M2: Predation mortality at age; dim = [nyrs, nages, nspp] }
 \item{M: Total natural mortality at age; dim = [nyrs, nages, nspp] }
 \item{}
 \item{2. Survey components}
 \item{srv_age_obs:}
 \item{srv_bio_hat: Estimated BT survey biomass (kg); dim = [nspp, nyrs] }
 \item{srv_hat: Estimated BT survey total abundance (n); dim = [nspp, nyrs] }
 \item{srv_age_hat: Estimated BT age comp; dim = [nspp, nages, nyrs] }
 \item{eit_hat: Estimated EIT survey biomass (kg); dim = [nyrs] }
 \item{eit_age_hat: Estimated EIT catch-at-age ; dim = [nyrs, srv_age_bins(0)] }
 \item{eit_age_comp_hat : Estimated EIT age comp ; dim = [nyrs, srv_age_bins(0)] }
 \item{obs_eit_age:}
 \item{eit_age_comp: Eit age comp; dim = [n_eit, srv_age_bins(0)] }
 \item{avgsel_srv: Average survey selectivity; dim = [1, nspp] }
 \item{srv_sel: Estimated survey selectivity at age; dim = [nspp, nyrs] }
 \item{}
 \item{3. Fishery components}
 \item{F: Estimated fishing mortality; dim = [nspp, nages, nyrs] }
 \item{F_dev:}
 \item{fsh_sel: Log estimated fishing selectivity; dim = [nyrs, srv_age_bins(0)] }
 \item{avgsel_fsh: Average fishery selectivity }
 \item{tc_biom_hat: Estimated total yield (kg); dim = [nspp, nyrs] }
 \item{catch_hat: Estimated catch-at-age (n); dim = [nspp, nages, nyrs] }
 \item{tc_hat: Estimated total catch (n); dim = [nspp, nyrs] }
 \item{fsh_age_hat: Estimated fishery age comp; dim = [nspp, nages, nyrs] }
 \item{fsh_age_obs: Observed fishery age comp; dim = [nyrs_fsh_comp, fsh_age_bins, nspp] }
 \item{}
 \item{3. Likelihood components}
 \item{jnll_comp: Matrix of negative log-likelihood components (See below) }
 \item{offset_srv: Offsets for multinomial likelihood }
 \item{offset_fsh: Offsets for multinomial likelihood }
 \item{offset_eit: Offsets for multinomial likelihood }
 \item{}
 \item{4. Ration components}
 \item{ConsumAge: Pre-allocated indiviudal consumption in grams per predator-age; dim = [nyrs, nages, nspp] }
 \item{Consum_livingAge: Pre-allocated indiviudal consumption in grams per predator-age; dim = [nyrs, nages, nspp] }
 \item{S2Age: pre-allocate mean stomach weight as a function of sp_age }
 \item{LbyAge: Length by age from LW regression }
 \item{mnWt_obs: Mean observed weight at age (across years); dim = [nspp, nages] }
 \item{fT:  Pre-allocation of temperature function of consumption; dim = [nspp, nTyrs]}
 \item{TempC: Bottom temperature; dim = [1, nTyrs] }
 \item{ration2Age: Annual ration at age (kg/yr); dim = [nyrs, nages, nspp] }
 \item{}
 \item{5. Suitability components}
 \item{suma_suit: Sum of suitabilities; dim = [nyrs, nages, nspp] }
 \item{suit_main: Suitability/gamma selectivity of predator age u on prey age a; dim = [nspp, nspp, nages, nages] }
 \item{suit_other: Suitability not accounted for by the included prey; dim = [nspp, nages] }
 \item{stom_div_bio2: // Stomach proportion over biomass; U/ (W * N) ; dim = [nspp, nspp, nages, nages, nyrs] }
 \item{stomKir: Stomach proportion U; dim = [nspp, nspp, nages, nages, nyrs] }
 \item{avail_food: Available food to predator; dim = [nyrs, nages, nspp] }
 \item{of_stomKir: Other food stomach content; dim = [nyrs, nages, nspp] }
 \item{B_eaten: Biomass of prey eaten via predation; dim = [nyrs, nages, nspp] }
 \item{}
 \item{6. Kinzey predation functions}
 \item{H_1: Functional response parameters from Kinzey & Punt (2009) }
 \item{H_1a: Functional response parameters from Kinzey & Punt (2009) }
 \item{H_1b: Functional response parameters from Kinzey & Punt (2009) }
 \item{H_2: Functional response parameters from Kinzey & Punt (2009) }
 \item{H_3: Functional response parameters from Kinzey & Punt (2009) }
 \item{gam_a: Predator gamma selectivity parameters }
 \item{gam_b: Predator gamma selectivity parameters }
 \item{N_pred_yrs: Effective numbers of predators for each age of prey }
 \item{N_prey_yrs: Effective numbers of prey for each age of prey }
 \item{N_pred_eq: Effective numbers of predators for each age of prey in equilibrium (styr_pred) }
 \item{N_prey_eq: Effective numbers of prey for each age of predator in equilibrium (styr_pred) }
 \item{pred_resp: Predator functional response }
 \item{Pred_r: Pred_ratio values }
 \item{Prey_r: Prey_ratio values }
 \item{Vmort_ua: Predation mortality on prey age a by single predator age u }
 \item{eaten_la: Number of prey of age a eaten by predator length l }
 \item{eaten_ua: Number of prey of age a eaten by predator age u }
 \item{Q_mass_l: Mass of each prey sp consumed by predator at length // FIXME: make into 4D array }
 \item{Q_mass_u: Mass of each prey sp consumed by predator at age // FIXME: make into 4D array }
 \item{Q_other_u: Mass of other prey consumed by predator at age }
 \item{Q_hat: Fraction for each prey type of total mass eaten by predator length }
 \item{T_hat: Fraction of prey of length m in predator of length l }
 \item{omega_hat: Estimated daily ration by predator age each year }
 \item{omega_hat_ave: Estimated daily ration by predator age averaged over years }
}


`jnll_comp` includes:
\itemize{
 \item{-- Data components}
\item{Slot 0 -- BT survey biomass -- NFMS annual BT survey}
\item{Slot 1 -- BT survey age composition -- NFMS annual BT survey}
\item{Slot 2 -- EIT survey biomass -- Pollock acoustic trawl survey}
\item{Slot 3 -- EIT age composition -- Pollock acoustic trawl survey}
\item{Slot 4 -- Total catch -- Fishery observer data}
\item{Slot 5 -- Fishery age composition -- Fishery observer data}
\item{-- Likelihood penalties}
\item{Slot 6 -- Fishery selectivity}
\item{Slot 7 -- Fishery selectivity normalization}
\item{Slot 8 -- Survey selectivity}
\item{Slot 9 -- Survey selectivity normalization}
\item{-- Priors}
\item{Slot 10 -- Tau -- Annual recruitment deviation}
\item{Slot 11 -- init_dev -- Initial abundance-at-age}
\item{Slot 12 -- Epsilon -- Annual fishing mortality deviation}
\item{-- M2 likelihood components}
\item{Slot 13 -- Ration likelihood}
\item{Slot 14 -- Ration penalties}
\item{Slot 15 -- Diet weight likelihood}
\item{Slot 16 -- Stomach content of prey length ln in predator length a likelihood}
}
}
\description{
This function estimates population parameters of CEATTLE using maximum likelihood in TMB.
}
\details{
CEATTLE is an age-structured population dynamics model that can be fit with or without predation mortality. The default is to exclude predation mortality by setting \code{msmMode} to 0. Predation mortality can be included by setting \code{msmMode} with the following options:
\itemize{
\item{0. Single species mode}
\item{1. Holsman et al. 2015 predation based on multi-species virtual population analysis (MSVPA) based predation formation.}
 \item{2. Kinzey & Punt 2010 Holling Type I (linear)}
 \item{3. Kinzey & Punt 2010 Holling Type II}
 \item{4. Kinzey & Punt 2010 Holling Type III}
 \item{5. Kinzey & Punt 2010 Predator interference}
 \item{6. Kinzey & Punt 2010 Predator preemption}
 \item{7. Kinzey & Punt 2010 Hassell-Varley}
 \item{8. Kinzey & Punt 2010 Ecosim}
 }
}
\examples{
library(Rceattle)
data(BS2017SS) # ?BS2017SS for more information on the data

# Then the model can be fit by setting `msmMode = 0` using the `Rceattle` function:
ss_run <- Rceattle(data_list = BS2017SS,
   inits = NULL, # Initial parameters = 0
   file_name = NULL, # Don't save
   debug = 0, # Estimate
   random_rec = FALSE, # No random recruitment
   msmMode = 0, # Single species mode
   avgnMode = 0,
   silent = TRUE)

}
