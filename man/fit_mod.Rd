% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6-fit_mod.R
\name{fit_mod}
\alias{fit_mod}
\title{This functions runs CEATTLE}
\usage{
fit_mod(
  data_list = NULL,
  inits = NULL,
  map = NULL,
  bounds = NULL,
  file = NULL,
  estimateMode = 0,
  projection_uncertainty = FALSE,
  random_rec = FALSE,
  random_q = FALSE,
  random_sel = FALSE,
  HCR = build_hcr(),
  niter = 3,
  recFun = build_srr(),
  M1Fun = build_M1(),
  msmMode = 0,
  avgnMode = 0,
  initMode = 2,
  suitMode = 0,
  suit_styr = NULL,
  suit_endyr = NULL,
  phase = FALSE,
  getsd = TRUE,
  bias.correct = FALSE,
  use_gradient = TRUE,
  rel_tol = 1,
  control = list(eval.max = 1e+09, iter.max = 1e+09, trace = 0),
  getJointPrecision = TRUE,
  getReportCovariance = FALSE,
  loopnum = 5,
  verbose = 1,
  newtonsteps = 0,
  catch_hcr = FALSE,
  TMBfilename = NULL
)
}
\arguments{
\item{data_list}{a data_list read in using \code{\link{read_excel}}.}

\item{inits}{(Optional) Character vector of named initial values from previous parameter estimates from Rceattle model. If NULL, will use 0 for starting parameters. Can also construct using \code{\link{build_params}}}

\item{map}{(Optional) A map object from \code{\link{build_map}}.}

\item{bounds}{(Optional) A bounds object from \code{\link{build_bounds}}.}

\item{file}{(Optional) Filename where files will be saved. If NULL, no file is saved.}

\item{estimateMode}{0 = Fit the hindcast model and projection with HCR specified via \code{HCR}. 1 = Fit the hindcast model only (no projection). 2 = Run the projection only with HCR specified via \code{HCR} given the initial parameters in \code{inits}.  3 = debug mode 1: runs the model through MakeADFun, but not nlminb, 4 = runs the model through MakeADFun and nlminb (will all parameters mapped out).}

\item{projection_uncertainty}{account for hindcast parameter uncertainty in projections when using an HCR? Default is FALSE for speed.}

\item{random_rec}{logical. If TRUE, treats recruitment deviations as random effects using the laplace approximation.The default is FALSE.}

\item{random_q}{logical. If TRUE, treats annual catchability deviations as random effects using the laplace approximation.The default is FALSE.}

\item{random_sel}{logical. If TRUE, treats annual selectivity deviations as random effects using the laplace approximation.The default is FALSE.}

\item{HCR}{HCR list object from \code{\link[build_hcr]}}

\item{niter}{Number of iterations for multispecies model}

\item{recFun}{The stock recruit-relationship parameterization from \code{\link{build_srr}}.}

\item{M1Fun}{M1 parameterizations and priors. Use \code{build_M1}.}

\item{msmMode}{The predation mortality functions to used. Defaults to no predation mortality used.}

\item{avgnMode}{The average abundance-at-age approximation to be used for predation mortality equations. 0 (default) is the \eqn{N/Z ( 1 - exp(-Z) )}, 1 is \eqn{N exp(-Z/2)}, 2 is \eqn{N}.}

\item{initMode}{how the population is initialized. 0 = initial age-structure estimated as free parameters; 1 = equilibrium age-structure estimated out from R0 + dev-yr1,  mortality (M1); 2 = equilibrium age-structure estimated out from R0,  mortality (M1), and initial population deviates; 3 = non-equilibrium age-structure estimated out from initial fishing mortality (Finit), R0,  mortality (M1), and initial population deviates.}

\item{suitMode}{Switch for suitability derivation for each predator (single value or vector). 0 = empirical based on diet data (Holsman et al. 2015), 1 = length-based gamma suitability (NOT WORKING), 2 = weight-based gamma suitability, 3 = length-based lognormal suitability (NOT WORKING), 4 = weight-based lognormal suitability, 5 = length-based normal suitability (NOT WORKING), 6 = weight-based normal suitability.}

\item{suit_styr}{Integer. The first year used to calculate mean suitability. Defaults to $styr$ in $data_list$. Used when diet data were sampled from a subset of years.}

\item{suit_endyr}{Integer. The last year used to calculate mean suitability. Defaults to $endyr$ in $data_list$. Used when diet data were sampled from a subset of years.}

\item{phase}{TRUE/FALSE If FALSE, will not phase model. If set to \code{"TRUE"}, will use default phasing. Can also accept a list of parameter object names with corresponding phase. See https://github.com/kaskr/TMB_contrib_R/blob/master/TMBphase/R/TMBphase.R.}

\item{getsd}{TRUE/FALSE whether to run standard error calculation (default = TRUE).}

\item{use_gradient}{use the gradient to phase (default = TRUE).}

\item{rel_tol}{The relative tolerance for discontinuous likelihood warnings. Set to 1. This evaluates the difference between the TMB object likelihood and the nlminb likelihood.}

\item{control}{A list of control parameters. For details see \code{?nlminb}}

\item{getJointPrecision}{return full Hessian of fixed and random effects.}

\item{getReportCovariance}{return variance covariance of ADREPORT variables}

\item{loopnum}{number of times to re-start optimization (where \code{loopnum=3} sometimes achieves a lower final gradient than \code{loopnum=1})}

\item{verbose}{0 = Silent, 1 = print updates of model fit, 2 = print updates of model fit and TMB estimation progress.}

\item{newtonsteps}{number of extra newton steps to take after optimization (alternative to \code{loopnum})}

\item{TMBfilename}{if a seperate TMB file is to be used for development. Includes location and does not include ".cpp" at the end.}
}
\value{
A list of class "Rceattle" including:

\itemize{
\item{data_list: List of data inputs}
\item{initial_params: List of starting parameters}
\item{bounds: Parameter bounds used for estimation}
\item{map: List of map used in TMB}
\item{obj: TMB model object}
\item{opt: Optimized model object from \code{nlimb}}
\item{sdrep: Object of class \code{sdreport} exported by TMB including the standard errors of estimated parameters}
\item{estimated_params: List of estimated parameters}
\item{quantities: Derived quantities from CEATTLE}
\item{run_time: Model run time}
}
}
\description{
This function estimates population parameters of CEATTLE using maximum likelihood in TMB.
}
\details{
CEATTLE is an age-structured population dynamics model that can be fit with or without predation mortality. The default is to exclude predation mortality by setting \code{msmMode} to 0. Predation mortality can be included by setting \code{msmMode} with the following options:
\itemize{
\item{0. Single species mode}
\item{1. Holsman et al. 2015 predation based on multi-species virtual population analysis (MSVPA) based predation formation.}
\item{2. MSVPA Holling Type III}
\item{3. Kinzey & Punt 2010 Holling Type I (linear) - Deprecated}
\item{4. Kinzey & Punt 2010 Holling Type II - Deprecated}
\item{5. Kinzey & Punt 2010 Holling Type III - Deprecated}
\item{6. Kinzey & Punt 2010 Predator interference - Deprecated}
\item{7. Kinzey & Punt 2010 Predator preemption - Deprecated}
\item{8. Kinzey & Punt 2010 Hassell-Varley - Deprecated}
\item{9. Kinzey & Punt 2010 Ecosim - Deprecated}
}
}
\examples{
# Load package and data
library(Rceattle)
data(BS2017SS) # ?BS2017SS for more information on the data


# Then the model can be fit by setting `msmMode = 0` using the `Rceattle` function:
ss_run <- fit_mod(data_list = BS2017SS,
   inits = NULL, # Initial parameters = 0
   file = NULL, # Don't save
   estimateMode = 0, # Estimate
   random_rec = FALSE, # No random recruitment
   msmMode = 0, # Single species mode
   avgnMode = 0,
   phase = FALSE,
   silent = TRUE)

}
